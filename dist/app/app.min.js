function preload(){soundFormats("ogg","mp3"),iBowls.globalReverbCarrier=createConvolver("assets/HaleHolisticYogaStudio")}function setup(){var a,b=iBowls.focusSequence();createCanvas(iBowls.w,iBowls.h),frameRate(iBowls.fps);for(var c=0;c<iBowls.maxBowls;c++)a=new Bowl({radius:random(10,30),sequence:b}),iBowls.bowls.push(a),iBowls.startedAt=new Date;iBowls.flock=new Flock;for(var c=0;c<iBowls.maxBoids;c++){var d=new Boid(random(0,iBowls.w),random(0,iBowls.h));iBowls.flock.addBoid(d)}}function draw(){var a=iBowls.getSequence();if("undefined"!=typeof a&&null!==a){for(var b=0;b<iBowls.bowls.length;b++)iBowls.bowls[b].play();fill(0,0,0,10),noStroke(),rect(0,0,iBowls.w,iBowls.h),iBowls.flock.run(a.notes[iBowls.currentIndex])}}function windowResized(){iBowls.w=$(window).width(),iBowls.h=$(window).height(),resizeCanvas(iBowls.w,iBowls.h)}var Bowl=function(a){this.init(a)};Bowl.prototype={_synth:null,_gong:null,_startedAt:null,_duration:null,_timeScaleFactor:1e3,_delay:4,_note:436,_color:null,_circleSize:50,defaults:{radius:10,sequence:null},init:function(a){return this.options=_.defaults(a,this.defaults),this._duration=a.radius*this._timeScaleFactor,this._synth=FM("gong",{amp:.75,index:7,cmRatio:5,attack:ms(1),maxVoices:4,decay:ms(this._duration)}),this.addRingModulator().addFlanger().addTremolo().addVibrato().addDelay().addReverb(),this},updateDuration:function(){this._duration=this.options.radius+this._timeScaleFactor*(this._length/3),this._synth=FM("gong",{amp:.75,index:7,cmRatio:5,attack:ms(1),maxVoices:4,decay:ms(this._duration)}),this.addRingModulator().addFlanger().addTremolo().addVibrato().addDelay().addReverb()},playReverbCarrierSound:function(){var a;a=new p5.Oscillator(this._note,"sine"),a.amp(.5),a.start(),a.disconnect(),iBowls.globalReverbCarrier.process(a),setTimeout(function(){a.fade(0,.2)},this._duration/1e3-50)},addTremolo:function(){var a=map(this._length,70.5,133.08,.25,.5),b=Tremolo({amp:1,frequency:a});return this._synth.fx.add(b),this},addVibrato:function(){var a=map(this._length,70.5,133.08,.25,1),b=Vibrato({rate:a});return this._synth.fx.add(b),this},addFlanger:function(){var a=map(this._length,70.5,133.08,.01,.09),b=Flanger({rate:a,feedback:.24});return this._synth.fx.add(b),this},addDelay:function(){var a=Delay({time:1e9,feedback:.25});return this._synth.fx.add(a),this},addRingModulator:function(){var a=RingMod({amp:.25,frequency:this._note-50});return this._synth.fx.add(a),this},addReverb:function(){var a=Reverb({roomSize:.99,damping:.5});return this._synth.fx.add(a),this},pickNote:function(){var a=0,b=this.options.sequence.length-1,c=Math.floor(Math.random()*(b-a+1))+a;this._note=this.options.sequence.notes[c].note,this._length=this.options.sequence.notes[c].length,this._color=this.options.sequence.notes[c].color,iBowls.currentIndex=c},pumpCircle:function(){this._circleSize=50,noStroke(),fill(this._color[0],this._color[1],this._color[2],10),ellipse(iBowls.w/2,iBowls.h/2,this._circleSize,this._circleSize)},growCircle:function(){this._circleSize+=20,this._circleSize<iBowls.w&&(noStroke(),fill(this._color[0],this._color[1],this._color[2],10),ellipse(iBowls.w/2,iBowls.h/2,this._circleSize,this._circleSize))},_play:function(){this.pickNote(),this.updateDuration(),this._synth.note(this._note),this.playReverbCarrierSound()},play:function(){var a,b=new Date;null===this._startedAt&&(this._play(),this.pumpCircle(),this._startedAt=b),a=b-this._startedAt,a>this._duration+1e3?(this._play(),this.pumpCircle(),this._startedAt=b):this.growCircle()},ring:function(){},setStartedAt:function(a){this._startedAt=a}};var Flock=function(){this.boids=[]};Flock.prototype={run:function(a){for(var b=0;b<this.boids.length;b++)this.boids[b].run(this.boids,a)},addBoid:function(a){this.boids.push(a)}};var Boid=function(a,b){this.init(a,b)};Boid.prototype={init:function(a,b){this.acceleration=createVector(0,0),this.velocity=createVector(random(-1,1),random(-1,1)),this.position=createVector(a,b),this.r=3,this.maxspeed=3,this.maxforce=.05},run:function(a,b){this.flock(a),this.update(),this.borders(),this.render(b)},applyForce:function(a){this.acceleration.add(a)},flock:function(a){var b=this.separate(a),c=this.align(a),d=this.cohesion(a);b.mult(1.5),c.mult(1),d.mult(1),this.applyForce(b),this.applyForce(c),this.applyForce(d)},update:function(){this.velocity.add(this.acceleration),this.velocity.limit(this.maxspeed),this.position.add(this.velocity),this.acceleration.mult(0)},seek:function(a){var b=p5.Vector.sub(a,this.position);b.normalize(),b.mult(this.maxspeed);var c=p5.Vector.sub(b,this.velocity);return c.limit(this.maxforce),c},drawCircle:function(a,b,c){fill(c.color),noStroke(),push(),translate(this.position.x,this.position.y),rotate(a),ellipse(0,0,b,b),pop()},render:function(a){var b=this.velocity.heading()+radians(90),c=map(a.length,70.5,133.08,5,10);this.drawCircle(b,c,a)},borders:function(){this.position.x<-this.r&&(this.position.x=width+this.r),this.position.y<-this.r&&(this.position.y=height+this.r),this.position.x>width+this.r&&(this.position.x=-this.r),this.position.y>height+this.r&&(this.position.y=-this.r)},separate:function(a){for(var b=25,c=createVector(0,0),d=0,e=0;e<a.length;e++){var f=p5.Vector.dist(this.position,a[e].position);if(f>0&&b>f){var g=p5.Vector.sub(this.position,a[e].position);g.normalize(),g.div(f),c.add(g),d++}}return d>0&&c.div(d),c.mag()>0&&(c.normalize(),c.mult(this.maxspeed),c.sub(this.velocity),c.limit(this.maxforce)),c},align:function(a){for(var b=50,c=createVector(0,0),d=0,e=0;e<a.length;e++){var f=p5.Vector.dist(this.position,a[e].position);f>0&&b>f&&(c.add(a[e].velocity),d++)}if(d>0){c.div(d),c.normalize(),c.mult(this.maxspeed);var g=p5.Vector.sub(c,this.velocity);return g.limit(this.maxforce),g}return createVector(0,0)},cohesion:function(a){for(var b=50,c=createVector(0,0),d=0,e=0;e<a.length;e++){var f=p5.Vector.dist(this.position,a[e].position);f>0&&b>f&&(c.add(a[e].position),d++)}return d>0?(c.div(d),this.seek(c)):createVector(0,0)}};var IBowls=function(a){this.init(a)};IBowls.prototype={opacity:50,notes:{},currentIndex:-1,w:$(window).width(),h:$(window).height(),flock:null,bowls:[],fps:60,maxBoids:100,maxBowls:1,fft:null,startedAt:new Date,globalReverbCarrier:null,noteScale:.5,sequence:"focus",init:function(){this.setNotes()},setNotes:function(){this.notes={c:{note:259.25*this.noteScale,length:133.08,color:[231,47,47,this.opacity]},cd:{note:274.66*this.noteScale,length:125.61,color:[240,125,49,this.opacity]},d:{note:290.99*this.noteScale,length:118.56,color:[240,125,49,this.opacity]},de:{note:308.3*this.noteScale,length:111.9,color:[216,171,3,this.opacity]},e:{note:326.63*this.noteScale,length:105.62,color:[216,171,3,this.opacity]},f:{note:346.05*this.noteScale,length:99.7,color:[14,150,69,this.opacity]},fg:{note:366.63*this.noteScale,length:94.1,color:[14,150,69,this.opacity]},g:{note:388.43*this.noteScale,length:88.82,color:[77,77,236,this.opacity]},ga:{note:411.53*this.noteScale,length:83.83,color:[77,77,236,this.opacity]},a:{note:436*this.noteScale,length:79.13,color:[147,55,199,this.opacity]},ab:{note:461.93*this.noteScale,length:74.69,color:[147,55,199,this.opacity]},b:{note:489.39*this.noteScale,length:70.5,color:[194,51,148,this.opacity]}}},getSequence:function(){switch(this.sequence){case"focus":return this.focusSequence();case"relax":return this.relaxSequence();case"heal":return this.relaxSequence()}},healSequence:function(){return{notes:[this.notes.f,this.notes.fg,this.notes.g,this.notes.b,this.notes.c],length:5}},relaxSequence:function(){return{notes:[this.notes.e,this.notes.b,this.notes.d,this.notes.a],length:4}},focusSequence:function(){return{notes:[this.notes.a,this.notes.c,this.notes.d,this.notes.g],length:4}}};var iBowls=new IBowls;$(document).ready(function(){$(".mood").click(function(a){a.preventDefault();var b=$(a.currentTarget);iBowls.sequence=b.attr("id"),$(".mood").removeClass("active"),b.addClass("active")})});